<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Transform your task descriptions into optimized AI prompts with Meta-Prompt Generator">
    <title>Meta-Prompt Generator</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
            width: 100%;
            padding-left: 15px;
            padding-right: 15px;
        }
        
        @media (max-width: 768px) {
            .container {
                max-width: 100%;
                padding-left: 10px;
                padding-right: 10px;
            }
            textarea {
                font-size: 16px; /* Prevents zoom on iOS */
            }
            .btn {
                min-height: 44px; /* Minimum touch target size */
            }
        }
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white !important;
        }
        .btn-generate:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            transform: translateY(-2px);
            color: white !important;
        }
        .loading {
            display: none;
        }
        .copy-btn {
            opacity: 0.7;
            transition: all 0.2s ease;
        }
        .copy-btn:hover {
            opacity: 1;
            transform: scale(1.05);
        }
        
        /* Enhanced focus styles for accessibility */
        .btn:focus,
        textarea:focus {
            outline: 2px solid #0d6efd;
            outline-offset: 2px;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }
        
        /* Custom focus for generate button */
        .btn-generate:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
        }
        textarea {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        
        /* Validation states */
        textarea:valid {
            border-color: #198754;
        }
        
        textarea:invalid {
            border-color: #dc3545;
        }
        
        textarea:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }
        
        pre {
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        /* Enhanced focus styles */
        button:focus,
        textarea:focus,
        [tabindex]:focus {
            outline: 2px solid #0d6efd;
            outline-offset: 2px;
        }
        /* Screen reader only content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        /* Loading animation enhancements */
        .loading {
            transition: opacity 0.3s ease-in-out;
        }
        /* Keyboard shortcut hints */
        [title]:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-12">
                <div class="text-center mb-5">
                    <h1 class="display-4 text-primary">ü§ñ Meta-Prompt Generator</h1>
                    <p class="lead text-muted">Transform your task descriptions into optimized AI prompts</p>
                    <div class="badge bg-info p-2 mt-3">
                        Powered by Giovanni ‚Ä¢ AIFabric
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <form id="promptForm">
                            <div class="mb-4">
                                <label for="inputText" class="form-label fs-5 fw-bold">
                                    üìù Task Description or Existing Prompt
                                </label>
                                <textarea
                                    class="form-control"
                                    id="inputText"
                                    name="input_text"
                                    rows="6"
                                    placeholder="Describe your task or paste an existing prompt here...&#10;&#10;Example: 'Write a function that calculates the factorial of a number and handles edge cases gracefully.'"
                                    required
                                    aria-label="Task description input"
                                    aria-required="true"
                                ></textarea>
                                <div class="form-text">
                                    Be as specific as possible about your goals, requirements, and expected output format.
                                </div>
                                <div id="charCount" class="text-end small text-muted mt-1" style="display: none;">
                                </div>
                            </div>

                            <div class="d-grid mb-4">
                                <button type="submit" class="btn btn-primary btn-lg btn-generate" id="generateBtn" aria-label="Generate optimized prompt" data-bs-toggle="tooltip" title="Ctrl+Enter">
                                    ‚ú® Generate Optimized Prompt
                                </button>
                            </div>

                            <div id="loading" class="text-center loading" role="status" aria-live="polite">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Generating prompt, please wait...</span>
                                </div>
                                <p class="mt-2 text-muted">Analyzing your request and crafting the perfect prompt...</p>
                                <div class="progress mt-2" style="height: 4px;">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </form>

                        <div id="result" class="mt-5" style="display: none;">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h4 class="mb-0 text-success">‚úÖ Generated Meta-Prompt</h4>
                                <button class="btn btn-outline-secondary copy-btn" id="copyBtn" aria-label="Copy generated prompt to clipboard" data-bs-toggle="tooltip" title="Ctrl+C">
                                    üìã Copy to Clipboard
                                </button>
                            </div>
                            <div class="card bg-light">
                                <div class="card-body">
                                    <pre id="generatedPrompt" class="mb-0" aria-live="polite"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-4 bg-info text-white">
                    <div class="card-body">
                        <h5 class="card-title">üí° How it works</h5>
                        <p class="card-text mb-0">
                            This tool uses advanced prompt engineering techniques to transform your description into a comprehensive system prompt that will guide AI models to produce better results for your specific task.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Auto-focus on page load
        document.addEventListener('DOMContentLoaded', function() {
            const inputText = document.getElementById('inputText');
            if (inputText) {
                inputText.focus();
            }
        });

        // Keyboard shortcuts and accessibility enhancements
        document.addEventListener('keydown', function(e) {
            // Ctrl+Enter to submit form
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                const generateBtn = document.getElementById('generateBtn');
                if (generateBtn && !generateBtn.disabled) {
                    generateBtn.click();
                }
            }

            // Ctrl+C to copy generated prompt (when result is visible)
            if ((e.ctrlKey || e.metaKey) && e.key === 'c') {
                const result = document.getElementById('result');
                if (result && result.style.display !== 'none') {
                    e.preventDefault();
                    document.getElementById('copyBtn').click();
                }
            }

            // Escape key to clear focus or close alerts
            if (e.key === 'Escape') {
                const activeElement = document.activeElement;
                if (activeElement && activeElement.tagName !== 'BODY') {
                    activeElement.blur();
                }
                
                // Close any open alerts
                const alerts = document.querySelectorAll('.alert');
                alerts.forEach(alert => {
                    const closeBtn = alert.querySelector('.btn-close');
                    if (closeBtn) {
                        closeBtn.click();
                    }
                });
            }

            // Tab navigation enhancement - focus on copy button after result
            if (e.key === 'Tab' && !e.shiftKey) {
                const activeElement = document.activeElement;
                const result = document.getElementById('result');
                if (result && result.style.display !== 'none' && 
                    activeElement === document.getElementById('generatedPrompt')) {
                    e.preventDefault();
                    document.getElementById('copyBtn').focus();
                }
            }
        });

        // Enhanced form validation with real-time feedback
        const inputText = document.getElementById('inputText');
        if (inputText) {
            inputText.addEventListener('input', function() {
                this.style.borderColor = this.value.trim() ? '#198754' : '#dc3545';
                
                // Show character count
                const charCount = this.value.length;
                const charCountElement = document.getElementById('charCount');
                if (charCountElement) {
                    charCountElement.textContent = `${charCount} characters`;
                    charCountElement.style.color = charCount > 10 ? '#198754' : '#dc3545';
                }
            });

            inputText.addEventListener('blur', function() {
                if (!this.value.trim()) {
                    this.style.borderColor = '#dc3545';
                }
            });

            inputText.addEventListener('focus', function() {
                this.style.borderColor = '#0d6efd';
                this.style.boxShadow = '0 0 0 0.2rem rgba(13, 110, 253, 0.25)';
            });
        }

        // Enhanced focus styles for all interactive elements
        const focusableElements = document.querySelectorAll('button, textarea, [tabindex]');
        focusableElements.forEach(element => {
            element.addEventListener('focus', function() {
                this.style.outline = '2px solid #0d6efd';
                this.style.outlineOffset = '2px';
            });

            element.addEventListener('blur', function() {
                this.style.outline = '';
                this.style.outlineOffset = '';
            });
        });

        document.getElementById('promptForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const inputText = document.getElementById('inputText').value.trim();
            if (!inputText) {
                showError('Please enter a task description or prompt.');
                document.getElementById('inputText').focus();
                return;
            }

            // Show loading state
            document.getElementById('loading').style.display = 'block';
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('generateBtn').innerHTML = '‚è≥ Generating...';

            // Hide previous result
            document.getElementById('result').style.display = 'none';

            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        input_text: inputText
                    })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('generatedPrompt').textContent = data.generated_prompt;
                    document.getElementById('result').style.display = 'block';
                    
                    // Focus on copy button after generation
                    setTimeout(() => {
                        document.getElementById('copyBtn').focus();
                    }, 100);
                } else {
                    showError('Error: ' + data.error);
                    document.getElementById('inputText').focus();
                }
            } catch (error) {
                showError('Network error: ' + error.message);
                document.getElementById('inputText').focus();
            }

            // Hide loading state
            document.getElementById('loading').style.display = 'none';
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('generateBtn').innerHTML = '‚ú® Generate Optimized Prompt';
        });

        // Enhanced error display function
        function showError(message) {
            // Remove existing errors first
            const existingErrors = document.querySelectorAll('.alert-danger');
            existingErrors.forEach(error => error.remove());

            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-danger alert-dismissible fade show mt-3';
            errorDiv.setAttribute('role', 'alert');
            errorDiv.innerHTML = `
                <strong>‚ö†Ô∏è Error:</strong> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            document.getElementById('promptForm').appendChild(errorDiv);
            
            // Auto-dismiss after 8 seconds
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    const closeBtn = errorDiv.querySelector('.btn-close');
                    if (closeBtn) {
                        closeBtn.click();
                    }
                }
            }, 8000);
        }

        // Success notification function
        function showSuccess(message) {
            const existingSuccess = document.querySelectorAll('.alert-success');
            existingSuccess.forEach(success => success.remove());

            const successDiv = document.createElement('div');
            successDiv.className = 'alert alert-success alert-dismissible fade show mt-3';
            successDiv.setAttribute('role', 'alert');
            successDiv.innerHTML = `
                <strong>‚úÖ Success:</strong> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            document.getElementById('promptForm').appendChild(successDiv);
            
            // Auto-dismiss after 3 seconds
            setTimeout(() => {
                if (successDiv.parentNode) {
                    const closeBtn = successDiv.querySelector('.btn-close');
                    if (closeBtn) {
                        closeBtn.click();
                    }
                }
            }, 3000);
        }

        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Auto-focus on input field
        const inputField = document.getElementById('inputText');
        if (inputField) {
            inputField.focus();
        }

        // Character counter functionality
        const charCount = document.getElementById('charCount');
        
        if (inputField && charCount) {
            inputField.addEventListener('input', function() {
                const length = this.value.length;
                charCount.style.display = length > 0 ? 'block' : 'none';
                charCount.textContent = `${length} characters`;
                
                // Color coding based on length
                if (length === 0) {
                    charCount.className = 'text-end small text-muted mt-1';
                } else if (length < 10) {
                    charCount.className = 'text-end small text-danger mt-1';
                } else if (length < 50) {
                    charCount.className = 'text-end small text-warning mt-1';
                } else {
                    charCount.className = 'text-end small text-success mt-1';
                }
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Enter to submit
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                if (document.getElementById('generateBtn').disabled === false) {
                    e.preventDefault();
                    document.getElementById('promptForm').dispatchEvent(new Event('submit'));
                }
            }
            
            // Ctrl/Cmd + C to copy (when result is visible)
            if ((e.ctrlKey || e.metaKey) && e.key === 'c') {
                if (document.getElementById('result').style.display !== 'none') {
                    e.preventDefault();
                    document.getElementById('copyBtn').click();
                }
            }
            
            // Escape key to clear focus and close alerts
            if (e.key === 'Escape') {
                const activeElement = document.activeElement;
                if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA' || activeElement.tagName === 'BUTTON')) {
                    activeElement.blur();
                }
                
                // Close any open alerts
                const alerts = document.querySelectorAll('.alert');
                alerts.forEach(alert => {
                    const closeBtn = alert.querySelector('.btn-close');
                    if (closeBtn) {
                        closeBtn.click();
                    }
                });
            }
        });

        // Enhanced copy to clipboard functionality
        document.getElementById('copyBtn').addEventListener('click', async function() {
            const promptText = document.getElementById('generatedPrompt').textContent;

            try {
                await navigator.clipboard.writeText(promptText);
                const originalText = this.innerHTML;
                const originalClass = this.className;
                this.innerHTML = '‚úÖ Copied!';
                this.className = 'btn btn-success copy-btn';
                showSuccess('Prompt copied to clipboard!');
                
                // Provide audio feedback for screen readers
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApMoOLwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApMoOLwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApMoOLwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApMoOLwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApMoOLwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApMoOLwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApMoOLwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApMoOLwtmMcBjiR1');
                audio.play().catch(() => {});
                
                setTimeout(() => {
                    this.innerHTML = originalText;
                    this.className = originalClass;
                }, 2000);
            } catch (err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = promptText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                const originalText = this.innerHTML;
                const originalClass = this.className;
                this.innerHTML = '‚úÖ Copied!';
                this.className = 'btn btn-success copy-btn';
                showSuccess('Prompt copied to clipboard!');
                setTimeout(() => {
                    this.innerHTML = originalText;
                    this.className = originalClass;
                }, 2000);
            }
        });

        // Add character counter to textarea
        const charCounter = document.createElement('div');
        charCounter.id = 'charCount';
        charCounter.className = 'form-text text-end mt-1';
        charCounter.textContent = '0 characters';
        charCounter.style.fontSize = '0.875rem';
        inputText.parentNode.appendChild(charCounter);

        // Add keyboard shortcut tooltips
        const generateBtn = document.getElementById('generateBtn');
        if (generateBtn) {
            generateBtn.title = 'Keyboard shortcut: Ctrl+Enter';
            generateBtn.setAttribute('aria-label', 'Generate optimized prompt (Ctrl+Enter)');
        }

        const copyBtn = document.getElementById('copyBtn');
        if (copyBtn) {
            copyBtn.title = 'Keyboard shortcut: Ctrl+C';
            copyBtn.setAttribute('aria-label', 'Copy to clipboard (Ctrl+C)');
        }

        // Prevent default form submission
        document.getElementById('promptForm').addEventListener('submit', function(e) {
            e.preventDefault();
        });

        // Add screen reader announcements
        function announceToScreenReader(message) {
            const announcer = document.getElementById('sr-announcer') || createScreenReaderAnnouncer();
            announcer.textContent = message;
        }

        function createScreenReaderAnnouncer() {
            const announcer = document.createElement('div');
            announcer.id = 'sr-announcer';
            announcer.className = 'sr-only';
            announcer.setAttribute('aria-live', 'polite');
            announcer.setAttribute('aria-atomic', 'true');
            document.body.appendChild(announcer);
            return announcer;
        }
    </script>
</body>
</html>